# Welcome to your prefect.yaml file! You can use this file for storing and managing
# configuration for deploying your flows. We recommend committing this file to source
# control along with your flow code.

# Generic metadata about this project
name: modal-prefect-simplest
prefect-version: 3.4.1

# build your custom image for all deployments (weâ€™ll only run first-flow on Docker)
build:
  - prefect_docker.deployments.steps.build_docker_image:
      id: build-first-flow # reference name for templates
      requires: prefect-docker>=0.3.0
      image_name: ghcr.io/loamin/modal-prefect-simplest
      tag: latest
      dockerfile: Dockerfile # use your custom Dockerfile

# push the image to your registry
push:
  - prefect_docker.deployments.steps.push_docker_image:
      requires: prefect-docker>=0.3.0
      image_name: "{{ build-first-flow.image_name }}"
      tag: "{{ build-first-flow.tag }}"

pull:
  - prefect.deployments.steps.git_clone:
      repository: https://github.com/loamincom/deploy-prefect.git
      branch: main
# the deployments section allows you to provide configuration for deploying flows
deployments:
  - name: first-flow
    version: null
    tags: []
    concurrency_limit: null
    description: This one runs on Prefect infra
    entrypoint: main.py:the_flow
    parameters: {}
    work_pool:
      # name: my-pool
      name: my-pool
      work_queue_name: null
      job_variables: {}
    schedules: []
  - name: second-flow
    version: null
    tags: []
    concurrency_limit: null
    description: This one runs on Modal
    entrypoint: main.py:the_another_flow
    parameters: {}
    work_pool:
      # name: my-pool
      name: modal-pool
      work_queue_name: null
      job_variables: {}
    schedules: []
  - name: third-flow
    version: null
    tags: []
    concurrency_limit: null
    description: This one runs on Modal and hopefully calls another `@flow`
    entrypoint: main.py:flow_sees_flow
    parameters: {}
    work_pool:
      # name: my-pool
      name: modal-pool
      work_queue_name: null
      job_variables: {}
    schedules: []
